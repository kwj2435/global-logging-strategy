## Logging, Exception 전략 정리 및 샘플 코드

---
### 소개
- Logging과 Exception 처리에 대한 유연하고 체계적인 방법을 고민하고, 실무 혹은 개인 프로젝트에서 사용할 수 있도록 정리
- Logging과 Exception 처리를 위한 Spring, 로깅 라이브러리 학습

--- 

### 실행 가이드
> git clone https://github.com/kwj2435/global-logging-strategy.git  
> cd global-logging-strategy  
> ./gradlew build  
> ./gradlew bootRun

---


### 내용 정리 및 샘플 코드 요구사항
### 0. Logging은 왜 해야할까?
- 서비스에 문제가 발생했을 경우 빠른 원인 파악을 위해 
- 로그 분석을 통한 서비스 성능 확인을 위해 ( ex. 메서드별 소요 시간 )
- 사용자 요청 데이터들을 통한 서비스 인사이트 획득을 위해
### 1. Logging 처리 전략
**첫째,** 반드시 필요한 로그만 남긴다.  

**둘째,** 사용자의 요청과 요청에 따른 응답을 명확히 확인할 수 있어야 한다.  

**셋째,** 운영과 개발 환경에서 적절한 레벨로 분리하여 로깅되어야 한다.  

**넷째,** 명확한 의미와 필요한 정보를 통해 편리하게 데이터를 얻을 수 있도록 로깅 정보를 설계한다.

**1.1 Logging 처리 전략에 따른 샘플 구현 요구 사항**
- Filter 에서 Request, Response의 URL을 포함한 메타데이터가 로깅될 수 있도록 한다.
- Debug 레벨에서 사용자의 요청에 따른 로직처리가 처리되는 과정을 트래킹 할 수 있도록 메서드 및 파라미터를 로깅한다.
- Exception을 제외한 Info 레벨의 로깅은 가능한 비즈니스 로직에서 제외하고 AOP를 활용하여 최상단 레벨에서 전역처리할 수 있도록한다.
- 운영환경은 Info 레벨의 로깅이 되도록한다.
- DB 쿼리 요청정보가 로깅되어야 한다.

**1.2 어떤 정보가 로깅되어야 할까?**
- 사용자의 요청, 응답
- Exception 및 Error
- DB 요청
- 핵심 메서드에서 로깅이 필요한 부분

### 2. Exception 처리 전략
**첫째,** 예외를 로깅해야 한다.
예외가 발생했을 때 로그를 남기면 문제의 원인을 파악하고 해결하는데 도움이 된다.

**둘째,** 커스텀 예외 클래스를 사용한다.
비즈니스 로직에 맞는 커스텀 예외를 작성하면 예외의 의미를 명확히 할 수 있다.

**셋째,** 애플리케이션 전역에서 예외를 처리할 수 있도록 @ControllerAdvice와 @ExceptionHandler를 활용한다.

**넷째,** 예외 발생 시 적절한 수준(ERROR, WARN, INFO)으로 로깅하여 문제를 추적 가능하게 한다.

다섯째, 예외 발생 상황에 대한 모니터링과 알림 설정을 한다.

**여섯째,** 예외 처리시 불필요한 try-catch를 줄이고, 가능한 한 높은 계층에서 Exception을 처리한다.
더불어 적절한 HTTP 상태 코드를 반환하여 클라이언트가 응답을 이해할 수 있게 한다.
또한 민감한 정보(예: 비밀번호, API 키)는 예외 메시지에 포함하지 않는다.

**2.1 Excpetion 처리 전략에 따른 구현 요구사항**
- 발생한 예외를 로깅한다.
- 커스텀 예외 클래스를 사용하여 공통된 예외 포맷을 만들어 전달한다.
- 가능한 높은 계층에서 Exception을 처리한다. (@ControllerAdvice 이용 AOP로 처리)
- Controller 계층이 아닌 Filter 계층에서 발생한 예외를 처리한다.
- 에러 정보가 담긴 코드를 Enum으로 관리하며 발생한 예외가 적절한 계층으로 전달되어 처리되도록 한다.
  - 비즈니스 로직에서 예외 객체 생성 -> Controller -> Exception Handler -> Client
- 라이브러리, 기타 모듈에서 발생한 예외에 대한 처리는 이번 프로젝트에서 별도 처리 하지 않는다.(Valid, Openfeign, etc.)
